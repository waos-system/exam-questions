<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="theme-color" content="#0b0e17">
  <title>QuizForge â€” è©¦é¨“å•é¡Œé›†</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg:       #0b0e17;
      --card:     #131720;
      --card2:    #1a2030;
      --border:   #252d3d;
      --border2:  #2e3a50;
      --accent:   #4f9eff;
      --accent-g: #00e5a0;
      --text:     #e0e8f8;
      --muted:    #7a8aaa;
      --dim:      #9ba8c0;
      --correct:  #22c57a;
      --wrong:    #f05252;
      --r:        12px;
      --rl:       18px;
      --rx:       24px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESET & BASE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }
    button { font-family: inherit; cursor: pointer; border: none; background: none; }
    a { color: inherit; text-decoration: none; }

    /* subtle grid */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(79,158,255,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(79,158,255,.03) 1px, transparent 1px);
      background-size: 48px 48px;
      pointer-events: none;
      z-index: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .site-header {
      position: fixed;
      inset: 0 0 auto 0;
      z-index: 300;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      background: rgba(11,14,23,.92);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }
    .logo {
      font-family: 'Space Mono', monospace;
      font-size: .95rem;
      font-weight: 700;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: .4rem;
      cursor: pointer;
      user-select: none;
    }
    .logo b { color: var(--text); }
    .logo-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--accent-g);
      box-shadow: 0 0 6px var(--accent-g);
    }
    .header-tag {
      font-family: 'Space Mono', monospace;
      font-size: .58rem;
      letter-spacing: .1em;
      color: var(--muted);
      border: 1px solid var(--border2);
      padding: 2px 8px;
      border-radius: 20px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VIEWS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    main { position: relative; z-index: 1; padding-top: 52px; }
    .view { display: none; }
    .view.active {
      display: block;
      animation: slideUp .28s cubic-bezier(.4,0,.2,1);
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(14px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* shared container */
    .page { max-width: 680px; margin: 0 auto; padding: 1.5rem 1rem 5rem; }
    .page-wide { max-width: 980px; margin: 0 auto; padding: 1.5rem 1rem 5rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION TITLE (shared)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .section-label {
      font-family: 'Space Mono', monospace;
      font-size: .62rem;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: .6rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HOME
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hero {
      text-align: center;
      padding: 2rem 0 2.5rem;
    }
    .hero-title {
      font-size: clamp(1.8rem, 5vw, 2.8rem);
      font-weight: 900;
      letter-spacing: -.03em;
      line-height: 1.15;
      margin-bottom: .75rem;
    }
    .hero-title em {
      font-style: normal;
      background: linear-gradient(120deg, var(--accent-g), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero-sub {
      color: var(--dim);
      font-size: .9rem;
      max-width: 380px;
      margin: 0 auto;
    }

    /* Subject blocks */
    .subject-block { margin-bottom: 2.5rem; }
    .subject-head {
      display: flex;
      align-items: center;
      gap: .6rem;
      padding-bottom: .7rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .subject-head-icon { font-size: 1.2rem; }
    .subject-head-name { font-size: 1rem; font-weight: 700; }
    .subject-head-desc { font-size: .75rem; color: var(--muted); margin-left: .15rem; }

    /* Exam accordion */
    .exam-block {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--rl);
      margin-bottom: .75rem;
      overflow: hidden;
      transition: border-color .2s;
    }
    .exam-block.open { border-color: var(--border2); }

    .exam-trigger {
      width: 100%;
      display: flex;
      align-items: center;
      gap: .75rem;
      padding: .9rem 1rem;
      text-align: left;
      background: none;
      cursor: pointer;
      transition: background .15s;
    }
    .exam-trigger:hover { background: rgba(255,255,255,.03); }
    .exam-trigger:active { background: rgba(255,255,255,.06); }

    .exam-badge {
      font-family: 'Space Mono', monospace;
      font-size: .6rem;
      font-weight: 700;
      padding: 3px 8px;
      border-radius: 6px;
      flex-shrink: 0;
    }
    .exam-name { font-size: .93rem; font-weight: 700; flex: 1; text-align: left; }
    .exam-level {
      font-family: 'Space Mono', monospace;
      font-size: .58rem;
      color: var(--muted);
      border: 1px solid var(--border2);
      padding: 2px 7px;
      border-radius: 5px;
      flex-shrink: 0;
      display: none;
    }
    @media (min-width: 480px) { .exam-level { display: block; } }
    .exam-arrow {
      font-size: .7rem;
      color: var(--muted);
      transition: transform .2s;
      flex-shrink: 0;
    }
    .exam-block.open .exam-arrow { transform: rotate(180deg); }

    /* Sections grid */
    .sections-wrap {
      display: none;
      padding: .25rem .75rem .75rem;
      border-top: 1px solid var(--border);
    }
    .exam-block.open .sections-wrap { display: block; }

    .sections-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: .5rem;
      padding-top: .5rem;
    }
    @media (max-width: 420px) {
      .sections-grid { grid-template-columns: 1fr 1fr; }
    }

    .sec-card {
      background: var(--card2);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: .85rem .9rem;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: .3rem;
      transition: all .18s;
      position: relative;
      overflow: hidden;
    }
    .sec-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: var(--c, var(--accent));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform .22s;
    }
    .sec-card:hover { border-color: rgba(255,255,255,.16); transform: translateY(-1px); }
    .sec-card:hover::before { transform: scaleX(1); }
    .sec-card:active { transform: scale(.98); }

    .sec-card.coming {
      opacity: .4;
      cursor: default;
    }
    .sec-card.coming:hover { transform: none; border-color: var(--border); }
    .sec-card.coming:hover::before { transform: scaleX(0); }

    .sec-icon { font-size: 1.2rem; }
    .sec-name { font-size: .82rem; font-weight: 700; line-height: 1.3; }
    .sec-desc { font-size: .7rem; color: var(--muted); line-height: 1.4; }
    .sec-count {
      font-family: 'Space Mono', monospace;
      font-size: .62rem;
      margin-top: .15rem;
    }
    .sec-soon {
      font-family: 'Space Mono', monospace;
      font-size: .55rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--muted);
      border: 1px solid var(--border2);
      padding: 1px 6px;
      border-radius: 4px;
      align-self: flex-start;
    }

    /* coming subjects row */
    .coming-row {
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }
    .coming-chips {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
      margin-top: .6rem;
    }
    .coming-chip {
      background: var(--card);
      border: 1px dashed var(--border2);
      border-radius: 8px;
      padding: .4rem .8rem;
      font-size: .78rem;
      color: var(--muted);
      opacity: .6;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SETUP MODAL (question count selector)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 500;
      background: rgba(0,0,0,.65);
      align-items: flex-end;
      justify-content: center;
      padding: 0;
    }
    @media (min-width: 600px) {
      .modal-overlay { align-items: center; padding: 1rem; }
    }
    .modal-overlay.show { display: flex; animation: fadeIn .2s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .modal-box {
      background: var(--card);
      border: 1px solid var(--border2);
      border-radius: var(--rx) var(--rx) 0 0;
      padding: 1.5rem 1.25rem 2rem;
      width: 100%;
      max-width: 480px;
      animation: slideModal .25s cubic-bezier(.4,0,.2,1);
    }
    @media (min-width: 600px) {
      .modal-box { border-radius: var(--rx); }
    }
    @keyframes slideModal {
      from { transform: translateY(30px); opacity: 0; }
      to   { transform: translateY(0); opacity: 1; }
    }

    .modal-drag {
      width: 40px; height: 4px;
      background: var(--border2);
      border-radius: 2px;
      margin: 0 auto 1.25rem;
    }
    @media (min-width: 600px) { .modal-drag { display: none; } }

    .modal-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: .3rem;
    }
    .modal-sub {
      font-size: .8rem;
      color: var(--muted);
      margin-bottom: 1.25rem;
    }
    .modal-genre-name {
      color: var(--accent);
    }

    /* Count picker */
    .count-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: .5rem;
      margin-bottom: 1.25rem;
    }
    .count-btn {
      background: var(--card2);
      border: 2px solid var(--border);
      border-radius: var(--r);
      padding: .7rem .4rem;
      text-align: center;
      cursor: pointer;
      transition: all .15s;
    }
    .count-btn:hover { border-color: var(--accent); }
    .count-btn.selected {
      border-color: var(--accent);
      background: rgba(79,158,255,.1);
    }
    .count-btn-num {
      font-family: 'Space Mono', monospace;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent);
      line-height: 1;
    }
    .count-btn-label {
      font-size: .65rem;
      color: var(--muted);
      margin-top: .2rem;
    }
    .count-btn.selected .count-btn-num { color: var(--accent); }

    /* custom input */
    .count-custom {
      margin-bottom: 1.25rem;
    }
    .count-custom label {
      font-size: .8rem;
      color: var(--dim);
      display: block;
      margin-bottom: .4rem;
    }
    .count-custom input {
      width: 100%;
      background: var(--card2);
      border: 2px solid var(--border);
      border-radius: var(--r);
      padding: .6rem .9rem;
      color: var(--text);
      font-size: 1rem;
      font-family: 'Space Mono', monospace;
      outline: none;
      transition: border-color .15s;
    }
    .count-custom input:focus { border-color: var(--accent); }

    .modal-actions {
      display: flex;
      gap: .6rem;
    }
    .btn-cancel {
      flex: 0 0 auto;
      padding: .75rem 1.2rem;
      border-radius: var(--r);
      border: 1px solid var(--border2);
      color: var(--muted);
      font-size: .9rem;
      font-weight: 700;
      transition: all .15s;
    }
    .btn-cancel:hover { color: var(--text); border-color: var(--muted); }
    .btn-start {
      flex: 1;
      padding: .75rem;
      border-radius: var(--r);
      background: var(--accent);
      color: #050d1a;
      font-size: .95rem;
      font-weight: 700;
      transition: all .18s;
    }
    .btn-start:hover { background: #74b7ff; box-shadow: 0 0 20px rgba(79,158,255,.35); }
    .btn-start:active { transform: scale(.98); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUIZ PAGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* Breadcrumb */
    .quiz-nav {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: .35rem;
      margin-bottom: 1rem;
      font-size: .76rem;
      color: var(--muted);
    }
    .quiz-nav a {
      color: var(--accent);
      cursor: pointer;
    }
    .quiz-nav a:hover { text-decoration: underline; }
    .quiz-nav-sep { color: var(--border2); }

    /* Progress header */
    .quiz-progress {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--rl);
      padding: .9rem 1rem;
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .qp-info { flex: 1; min-width: 0; }
    .qp-row {
      display: flex;
      justify-content: space-between;
      font-size: .72rem;
      color: var(--muted);
      margin-bottom: .35rem;
      font-family: 'Space Mono', monospace;
    }
    .qp-bar-track {
      height: 5px;
      background: var(--border);
      border-radius: 5px;
      overflow: hidden;
    }
    .qp-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-g), var(--accent));
      border-radius: 5px;
      transition: width .45s cubic-bezier(.4,0,.2,1);
    }
    .qp-score {
      text-align: center;
      flex-shrink: 0;
    }
    .qp-score-num {
      font-family: 'Space Mono', monospace;
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--accent-g);
      line-height: 1;
    }
    .qp-score-den {
      font-family: 'Space Mono', monospace;
      font-size: .65rem;
      color: var(--muted);
    }

    /* Question card */
    .q-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--rl);
      padding: 1.25rem 1.1rem;
      margin-bottom: .75rem;
    }
    .q-num {
      font-family: 'Space Mono', monospace;
      font-size: .62rem;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: .6rem;
    }
    .q-text {
      font-size: 1rem;
      font-weight: 500;
      line-height: 1.7;
      white-space: pre-wrap;
    }

    /* Choices */
    .choices { display: flex; flex-direction: column; gap: .5rem; margin-bottom: .75rem; }

    .choice {
      background: var(--card);
      border: 1.5px solid var(--border);
      border-radius: var(--r);
      padding: .8rem .9rem;
      display: flex;
      align-items: flex-start;
      gap: .7rem;
      cursor: pointer;
      text-align: left;
      color: var(--text);
      font-size: .92rem;
      line-height: 1.5;
      width: 100%;
      transition: all .15s;
      -webkit-tap-highlight-color: transparent;
    }
    .choice:hover:not(:disabled) {
      border-color: rgba(255,255,255,.2);
      background: var(--card2);
    }
    .choice:active:not(:disabled) { transform: scale(.99); }
    .choice:disabled { cursor: default; }

    .choice-key {
      font-family: 'Space Mono', monospace;
      font-size: .65rem;
      font-weight: 700;
      min-width: 22px;
      height: 22px;
      border-radius: 5px;
      background: var(--card2);
      border: 1px solid var(--border2);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 1px;
      transition: all .15s;
    }
    .choice.correct {
      border-color: var(--correct);
      background: rgba(34,197,122,.07);
    }
    .choice.correct .choice-key {
      background: var(--correct);
      color: #051a0e;
      border-color: var(--correct);
    }
    .choice.wrong {
      border-color: var(--wrong);
      background: rgba(240,82,82,.07);
    }
    .choice.wrong .choice-key {
      background: var(--wrong);
      color: white;
      border-color: var(--wrong);
    }

    /* Result badge */
    .result-badge {
      display: none;
      padding: .65rem;
      border-radius: var(--r);
      font-weight: 700;
      font-size: .92rem;
      text-align: center;
      margin-bottom: .65rem;
    }
    .result-badge.show { display: block; animation: pop .28s cubic-bezier(.34,1.56,.64,1); }
    @keyframes pop { from { transform: scale(.85); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .result-badge.correct { background: rgba(34,197,122,.1); color: var(--correct); border: 1px solid rgba(34,197,122,.25); }
    .result-badge.wrong   { background: rgba(240,82,82,.08); color: var(--wrong);   border: 1px solid rgba(240,82,82,.2); }

    /* Explanation */
    .explanation {
      display: none;
      background: var(--card2);
      border-left: 3px solid var(--accent-g);
      border-radius: 0 var(--r) var(--r) 0;
      padding: .9rem 1rem;
      margin-bottom: .75rem;
    }
    .explanation.show { display: block; animation: fadeIn .22s ease; }
    .expl-label {
      font-family: 'Space Mono', monospace;
      font-size: .6rem;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--accent-g);
      margin-bottom: .35rem;
    }
    .expl-text { font-size: .86rem; line-height: 1.72; color: var(--dim); }

    /* Next button */
    .btn-next {
      width: 100%;
      padding: .85rem;
      border-radius: var(--rl);
      background: var(--accent);
      color: #050d1a;
      font-size: .95rem;
      font-weight: 700;
      transition: all .18s;
    }
    .btn-next:hover:not(:disabled) {
      background: #74b7ff;
      box-shadow: 0 0 22px rgba(79,158,255,.3);
    }
    .btn-next:active:not(:disabled) { transform: scale(.99); }
    .btn-next:disabled {
      background: var(--border);
      color: var(--muted);
      cursor: default;
      box-shadow: none;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESULT PAGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .result-page { max-width: 480px; margin: 0 auto; padding: 2rem 1rem 5rem; text-align: center; }

    .result-ring-wrap {
      width: 140px;
      height: 140px;
      position: relative;
      margin: 0 auto 1.5rem;
    }
    .result-ring-wrap svg {
      position: absolute;
      inset: 0;
      transform: rotate(-90deg);
    }
    .result-ring-inner {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .ring-score {
      font-family: 'Space Mono', monospace;
      font-size: 2rem;
      font-weight: 700;
      line-height: 1;
    }
    .ring-denom { font-size: .75rem; color: var(--muted); }

    .result-grade {
      font-size: 1.6rem;
      font-weight: 900;
      letter-spacing: -.02em;
      margin-bottom: .4rem;
    }
    .result-sub { color: var(--muted); font-size: .88rem; margin-bottom: 1.5rem; }

    .result-stats {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--rl);
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    .stat { text-align: center; }
    .stat-val {
      font-family: 'Space Mono', monospace;
      font-size: 1.4rem;
      font-weight: 700;
      line-height: 1;
    }
    .stat-val.green { color: var(--correct); }
    .stat-val.red   { color: var(--wrong); }
    .stat-label { font-size: .7rem; color: var(--muted); margin-top: .2rem; }

    .result-actions { display: flex; flex-direction: column; gap: .5rem; }
    .btn-retry {
      width: 100%;
      padding: .85rem;
      border-radius: var(--rl);
      background: var(--accent);
      color: #050d1a;
      font-size: .95rem;
      font-weight: 700;
      transition: all .18s;
    }
    .btn-retry:hover { background: #74b7ff; box-shadow: 0 0 22px rgba(79,158,255,.3); }
    .btn-home {
      width: 100%;
      padding: .85rem;
      border-radius: var(--rl);
      border: 1px solid var(--border2);
      color: var(--muted);
      font-size: .9rem;
      font-weight: 700;
      transition: all .15s;
    }
    .btn-home:hover { color: var(--text); border-color: var(--muted); }

    /* error state */
    .error-box {
      text-align: center;
      padding: 3rem 1rem;
    }
    .error-box h2 { color: var(--wrong); margin-bottom: .5rem; }
    .error-box pre {
      background: var(--card2);
      border-radius: var(--r);
      padding: .75rem;
      font-size: .78rem;
      color: var(--muted);
      margin-top: 1rem;
      text-align: left;
      overflow-x: auto;
    }

    /* scrollbar */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 4px; }
  </style>
</head>
<body>

<!-- â”€â”€ HEADER â”€â”€ -->
<header class="site-header">
  <div class="logo" onclick="goHome()">
    <span class="logo-dot"></span>
    Quiz<b>Forge</b>
  </div>
  <span class="header-tag">Î²ç‰ˆ</span>
</header>

<!-- â”€â”€ SETUP MODAL (question count) â”€â”€ -->
<div class="modal-overlay" id="modal" onclick="handleOverlayClick(event)">
  <div class="modal-box">
    <div class="modal-drag"></div>
    <div class="modal-title">ä½•å•è§£ãã¾ã™ã‹ï¼Ÿ</div>
    <div class="modal-sub">ã‚¸ãƒ£ãƒ³ãƒ«ï¼š<span class="modal-genre-name" id="modal-genre-name">â€”</span></div>

    <div class="count-grid" id="count-grid"></div>

    <div class="count-custom">
      <label for="custom-count">ã‚«ã‚¹ã‚¿ãƒ å•é¡Œæ•°ï¼ˆ1ã€œ<span id="max-count-label">?</span>å•ï¼‰</label>
      <input type="number" id="custom-count" min="1" placeholder="æ•°å­—ã‚’å…¥åŠ›" inputmode="numeric">
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn-start" onclick="confirmStart()">ã‚¹ã‚¿ãƒ¼ãƒˆ â–¶</button>
    </div>
  </div>
</div>

<main>

  <!-- â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-home" class="view active">
    <div class="page-wide" id="home-content"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-quiz" class="view">
    <div class="page">
      <div class="quiz-nav">
        <a onclick="goHome()">ğŸ  ãƒ›ãƒ¼ãƒ </a>
        <span class="quiz-nav-sep">â€º</span>
        <span id="bc-exam">â€”</span>
        <span class="quiz-nav-sep">â€º</span>
        <span id="bc-section">â€”</span>
      </div>

      <div class="quiz-progress">
        <div class="qp-info">
          <div class="qp-row">
            <span id="qp-label">å•é¡Œ 1 / 10</span>
            <span id="qp-pct">0%</span>
          </div>
          <div class="qp-bar-track">
            <div class="qp-bar-fill" id="qp-fill" style="width:0%"></div>
          </div>
        </div>
        <div class="qp-score">
          <div class="qp-score-num" id="qp-score">0</div>
          <div class="qp-score-den" id="qp-denom">/ 10</div>
        </div>
      </div>

      <div class="q-card">
        <div class="q-num" id="q-num">Q1</div>
        <div class="q-text" id="q-text">èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>

      <div class="choices" id="choices"></div>

      <div class="result-badge" id="result-badge"></div>
      <div class="explanation" id="explanation">
        <div class="expl-label">ğŸ“– è§£èª¬</div>
        <div class="expl-text" id="expl-text"></div>
      </div>

      <button class="btn-next" id="btn-next" onclick="nextQuestion()" disabled>æ¬¡ã®å•é¡Œã¸ â†’</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â• RESULT â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-result" class="view">
    <div class="result-page">
      <div class="result-ring-wrap">
        <svg viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg">
          <circle cx="70" cy="70" r="58" fill="none" stroke="#1a2030" stroke-width="11"/>
          <circle cx="70" cy="70" r="58" fill="none"
            stroke="url(#rg)" stroke-width="11"
            stroke-linecap="round"
            stroke-dasharray="364.4"
            stroke-dashoffset="364.4"
            id="ring-arc"/>
          <defs>
            <linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#00e5a0"/>
              <stop offset="100%" stop-color="#4f9eff"/>
            </linearGradient>
          </defs>
        </svg>
        <div class="result-ring-inner">
          <div class="ring-score" id="ring-score">0</div>
          <div class="ring-denom" id="ring-denom">/ 10</div>
        </div>
      </div>

      <div class="result-grade" id="result-grade">ãŠç–²ã‚Œã•ã¾ã§ã—ãŸ</div>
      <div class="result-sub" id="result-sub">çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>

      <div class="result-stats">
        <div class="stat">
          <div class="stat-val green" id="stat-ok">0</div>
          <div class="stat-label">âœ“ æ­£è§£</div>
        </div>
        <div class="stat">
          <div class="stat-val red" id="stat-ng">0</div>
          <div class="stat-label">âœ— ä¸æ­£è§£</div>
        </div>
        <div class="stat">
          <div class="stat-val" id="stat-pct">0%</div>
          <div class="stat-label">æ­£è§£ç‡</div>
        </div>
        <div class="stat">
          <div class="stat-val" id="stat-total" style="color:var(--dim)">10</div>
          <div class="stat-label">å‡ºé¡Œæ•°</div>
        </div>
      </div>

      <div class="result-actions">
        <button class="btn-retry" id="btn-retry" onclick="retryQuiz()">ã‚‚ã†ä¸€åº¦ã“ã®å•é¡Œæ•°ã§æŒ‘æˆ¦ ğŸ”„</button>
        <button class="btn-home" onclick="goHome()">ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠã¸æˆ»ã‚‹</button>
      </div>
    </div>
  </div>

</main>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let allQuestions  = [];   // loaded from JSON
let sessionQs     = [];   // sliced & shuffled for this session
let currentIdx    = 0;
let score         = 0;
let answered      = false;
let currentFile   = '';
let currentExam   = '';
let currentSection = '';
let selectedCount = 10;   // chosen by user

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-' + id).classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function goHome() { showView('home'); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT / HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function init() {
  try {
    const res = await fetch('data/genres.json');
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    renderHome(data);
  } catch (e) {
    document.getElementById('home-content').innerHTML = `
      <div class="error-box">
        <h2>âš ï¸ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</h2>
        <p>Webã‚µãƒ¼ãƒçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚</p>
        <pre>npx serve .\n# ã¾ãŸã¯\npython3 -m http.server 8080</pre>
      </div>`;
  }
}

function renderHome(data) {
  const wrap = document.getElementById('home-content');
  let html = `
    <div class="hero">
      <h1 class="hero-title">è©¦é¨“ã§<em>åˆæ ¼</em>ã‚’ã¤ã‹ã‚€</h1>
      <p class="hero-sub">ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã‚“ã§ã€å•é¡Œæ•°ã‚’æ±ºã‚ã¦ã‚¹ã‚¿ãƒ¼ãƒˆã€‚è§£èª¬ã§ç†è§£ã‚’æ·±ã‚ã‚‹åå¾©å­¦ç¿’ã€‚</p>
    </div>`;

  for (const subject of data.subjects) {
    html += `<div class="subject-block">
      <div class="subject-head">
        <span class="subject-head-icon">${subject.icon}</span>
        <span class="subject-head-name">${subject.name}</span>
        <span class="subject-head-desc">${subject.description}</span>
      </div>`;

    for (const exam of subject.exams) {
      html += `
        <div class="exam-block" id="exam-${exam.id}">
          <button class="exam-trigger" onclick="toggleExam('${exam.id}')">
            <span class="exam-badge"
              style="background:${exam.color}22;color:${exam.color};border:1px solid ${exam.color}44">
              ${exam.short}
            </span>
            <span class="exam-name">${exam.name}</span>
            <span class="exam-level">${exam.level}</span>
            <span class="exam-arrow">â–¼</span>
          </button>
          <div class="sections-wrap">
            <div class="sections-grid">`;

      for (const sec of exam.sections) {
        const cs = !!sec.coming_soon;
        html += `
          <div class="sec-card${cs ? ' coming' : ''}"
            style="--c:${exam.color}"
            ${cs ? '' : `onclick="openModal('${sec.file}','${exam.name}','${sec.name}',${sec.count})"`}>
            <div class="sec-icon">${sec.icon}</div>
            <div class="sec-name">${sec.name}</div>
            <div class="sec-desc">${sec.description}</div>
            ${cs
              ? `<span class="sec-soon">æº–å‚™ä¸­</span>`
              : `<div class="sec-count" style="color:${exam.color}">${sec.count}å•</div>`}
          </div>`;
      }

      html += `</div></div></div>`; // grid / wrap / exam-block
    }
    html += `</div>`; // subject-block
  }

  html += `
    <div class="coming-row">
      <div class="section-label">// ä»Šå¾Œè¿½åŠ äºˆå®š</div>
      <div class="coming-chips">
        <span class="coming-chip">ğŸ“ æ•°å­¦ãƒ»ç†ç³»</span>
        <span class="coming-chip">ğŸ“œ ç¤¾ä¼šãƒ»æ­´å²</span>
        <span class="coming-chip">âš–ï¸ æ³•å¾‹ãƒ»è¡Œæ”¿æ›¸å£«</span>
        <span class="coming-chip">ğŸ¥ åŒ»ç™‚ç³»è³‡æ ¼</span>
      </div>
    </div>`;

  wrap.innerHTML = html;
}

function toggleExam(id) {
  document.getElementById('exam-' + id).classList.toggle('open');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL (question count picker)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PRESETS = [5, 10, 15, 20];

function openModal(file, exam, section, totalCount) {
  currentFile    = file;
  currentExam    = exam;
  currentSection = section;

  document.getElementById('modal-genre-name').textContent = section;
  document.getElementById('max-count-label').textContent  = totalCount;
  document.getElementById('custom-count').value = '';
  document.getElementById('custom-count').max = totalCount;

  // Build preset buttons (only those â‰¤ totalCount)
  const grid = document.getElementById('count-grid');
  grid.innerHTML = '';
  let defaultSet = false;

  PRESETS.forEach(n => {
    if (n > totalCount) return;
    const btn = document.createElement('button');
    btn.className = 'count-btn' + (n === 10 ? ' selected' : '');
    btn.innerHTML = `<div class="count-btn-num">${n}</div><div class="count-btn-label">å•</div>`;
    btn.onclick = () => selectPreset(n);
    grid.appendChild(btn);
    if (n === 10) { selectedCount = 10; defaultSet = true; }
  });

  // If 10 not available, select first
  if (!defaultSet) {
    const available = PRESETS.filter(n => n <= totalCount);
    selectedCount = available.length ? available[0] : totalCount;
    grid.querySelector('.count-btn')?.classList.add('selected');
  }

  // If totalCount itself isn't a preset, add "å…¨å•" button
  if (!PRESETS.includes(totalCount)) {
    const btn = document.createElement('button');
    btn.className = 'count-btn';
    btn.innerHTML = `<div class="count-btn-num">${totalCount}</div><div class="count-btn-label">å…¨å•</div>`;
    btn.onclick = () => selectPreset(totalCount);
    grid.appendChild(btn);
  }

  document.getElementById('modal').classList.add('show');
  document.body.style.overflow = 'hidden';
}

function selectPreset(n) {
  selectedCount = n;
  document.querySelectorAll('.count-btn').forEach(b => b.classList.remove('selected'));
  event.currentTarget.classList.add('selected');
  document.getElementById('custom-count').value = '';
}

function closeModal() {
  document.getElementById('modal').classList.remove('show');
  document.body.style.overflow = '';
}

function handleOverlayClick(e) {
  if (e.target === document.getElementById('modal')) closeModal();
}

function confirmStart() {
  const custom = document.getElementById('custom-count').value;
  if (custom) {
    const n = parseInt(custom, 10);
    if (!n || n < 1) { alert('1ä»¥ä¸Šã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
    selectedCount = n;
  }
  closeModal();
  startQuiz(currentFile, currentExam, currentSection, selectedCount);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUIZ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function startQuiz(file, exam, section, count) {
  try {
    const res = await fetch(file);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    allQuestions = data.questions;

    const shuffled = shuffle([...allQuestions]);
    sessionQs = shuffled.slice(0, Math.min(count, shuffled.length));

    currentIdx = 0;
    score = 0;
    currentExam    = exam;
    currentSection = section;

    document.getElementById('bc-exam').textContent    = exam;
    document.getElementById('bc-section').textContent = section;
    document.getElementById('qp-denom').textContent   = '/ ' + sessionQs.length;

    showView('quiz');
    renderQuestion();
  } catch(e) {
    alert('å•é¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚\nWebã‚µãƒ¼ãƒçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚\n\n' + e);
  }
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function renderQuestion() {
  answered = false;
  const q     = sessionQs[currentIdx];
  const total = sessionQs.length;
  const pct   = Math.round((currentIdx / total) * 100);

  document.getElementById('qp-label').textContent = `å•é¡Œ ${currentIdx+1} / ${total}`;
  document.getElementById('qp-pct').textContent   = pct + '%';
  document.getElementById('qp-fill').style.width  = pct + '%';
  document.getElementById('qp-score').textContent  = score;
  document.getElementById('q-num').textContent     = `Q${currentIdx+1}`;
  document.getElementById('q-text').textContent    = q.question;

  const keys = ['A','B','C','D','E','F'];
  document.getElementById('choices').innerHTML = q.choices.map((c, i) => `
    <button class="choice" onclick="selectAnswer(${i})">
      <span class="choice-key">${keys[i]}</span>
      <span>${c}</span>
    </button>`).join('');

  document.getElementById('result-badge').className  = 'result-badge';
  document.getElementById('explanation').className   = 'explanation';
  const nb = document.getElementById('btn-next');
  nb.disabled = true;
  nb.textContent = (currentIdx < total - 1) ? 'æ¬¡ã®å•é¡Œã¸ â†’' : 'çµæœã‚’è¦‹ã‚‹ ğŸ†';
}

function selectAnswer(idx) {
  if (answered) return;
  answered = true;

  const q   = sessionQs[currentIdx];
  const btns = document.querySelectorAll('.choice');
  btns.forEach(b => b.disabled = true);

  const ok = (idx === q.answer);
  if (ok) score++;

  btns[q.answer].classList.add('correct');
  if (!ok) btns[idx].classList.add('wrong');

  const badge = document.getElementById('result-badge');
  badge.className = `result-badge show ${ok ? 'correct' : 'wrong'}`;
  badge.textContent = ok ? 'âœ“ æ­£è§£ï¼' : 'âœ— ä¸æ­£è§£';

  document.getElementById('expl-text').textContent = q.explanation;
  document.getElementById('explanation').className = 'explanation show';
  document.getElementById('btn-next').disabled = false;
}

function nextQuestion() {
  currentIdx++;
  if (currentIdx >= sessionQs.length) {
    showResult();
  } else {
    renderQuestion();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showResult() {
  const total = sessionQs.length;
  const pct   = Math.round((score / total) * 100);
  const arc   = 2 * Math.PI * 58; // 364.4

  document.getElementById('ring-score').textContent = score;
  document.getElementById('ring-denom').textContent = '/ ' + total;
  document.getElementById('stat-ok').textContent    = score;
  document.getElementById('stat-ng').textContent    = total - score;
  document.getElementById('stat-pct').textContent   = pct + '%';
  document.getElementById('stat-total').textContent = total;

  // Animate ring
  const ringEl = document.getElementById('ring-arc');
  ringEl.style.strokeDashoffset = arc;
  showView('result');
  setTimeout(() => {
    ringEl.style.transition = 'stroke-dashoffset .9s cubic-bezier(.4,0,.2,1)';
    ringEl.style.strokeDashoffset = arc * (1 - pct / 100);
  }, 80);

  let grade, sub;
  if (pct === 100)    { grade = 'ğŸ‰ ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼'; sub = `${total}å•å…¨å•æ­£è§£ï¼å®Œç’§ã§ã™ï¼`; }
  else if (pct >= 80) { grade = 'ğŸŒŸ å„ªç§€ï¼';        sub = `${total}å•ä¸­${score}å•æ­£è§£ï¼ˆ${pct}%ï¼‰â€” ã‚ã¨ä¸€æ­©ï¼`; }
  else if (pct >= 60) { grade = 'ğŸ‘ åˆæ ¼åœå†…ï¼';    sub = `${total}å•ä¸­${score}å•æ­£è§£ï¼ˆ${pct}%ï¼‰â€” ã•ã‚‰ã«ä¸Šã‚’ç›®æŒ‡ãã†`; }
  else if (pct >= 40) { grade = 'ğŸ“š è¦å¾©ç¿’';        sub = `${total}å•ä¸­${score}å•æ­£è§£ï¼ˆ${pct}%ï¼‰â€” ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ï¼`; }
  else                 { grade = 'ğŸ’ª é ‘å¼µã‚ã†ï¼';   sub = `${total}å•ä¸­${score}å•æ­£è§£ï¼ˆ${pct}%ï¼‰â€” åŸºç¤ã‹ã‚‰è¦‹ç›´ãã†`; }

  document.getElementById('result-grade').textContent = grade;
  document.getElementById('result-sub').textContent   = sub;
  document.getElementById('btn-retry').textContent    =
    `åŒã˜${total}å•ã§ã‚‚ã†ä¸€åº¦ ğŸ”„`;
}

function retryQuiz() {
  startQuiz(currentFile, currentExam, currentSection, sessionQs.length);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   START
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
init();
</script>
</body>
</html>
