import json
from pathlib import Path


def q(qid, question, choices, answer, explanation):
    return {
        "id": qid,
        "question": question,
        "choices": choices,
        "answer": answer,
        "explanation": explanation,
    }


strategy_questions = [
    q("ip_st_001", "SWOT分析で、企業の内部環境に該当するものはどれか。", ["機会と脅威", "強みと弱み", "市場規模と成長率", "為替変動と金利",], 1, "内部環境は強みと弱み、外部環境は機会と脅威で整理する。"),
    q("ip_st_002", "損益計算書（P/L）で、売上高から売上原価を差し引いて求める利益はどれか。", ["営業利益", "経常利益", "売上総利益", "当期純利益"], 2, "売上高−売上原価で売上総利益を求める。"),
    q("ip_st_003", "ROEが示す指標として最も適切なものはどれか。", ["総資産に対する利益率", "自己資本に対する利益率", "売上高に対する営業利益率", "借入金に対する利息負担率"], 1, "ROEは自己資本利益率であり、自己資本をどれだけ効率よく使ったかを示す。"),
    q("ip_st_004", "BPRの目的として最も適切なものはどれか。", ["既存業務をそのままシステム化する", "業務プロセスを抜本的に見直す", "会計基準を統一する", "人員評価制度を改定する"], 1, "BPRは業務プロセスを根本から再設計し、成果を大きく改善する考え方。"),
    q("ip_st_005", "CRMを導入する主な目的はどれか。", ["部門別の原価を管理する", "顧客との関係を強化する", "在庫数量を最適化する", "給与計算を効率化する"], 1, "CRMは顧客情報を活用し、満足度や継続利用を高めるための仕組み。"),
    q("ip_st_006", "サブスクリプション型ビジネスモデルの特徴として適切なものはどれか。", ["初回に高額の一括支払いのみが発生する", "継続課金により収益を得る", "在庫を持たないことが必須である", "広告収入を主な収益源とする"], 1, "サブスクリプションは定期的な利用料を収益の中心とする。"),
    q("ip_st_007", "知的財産権のうち、発明を保護する権利はどれか。", ["著作権", "商標権", "特許権", "意匠権"], 2, "発明の保護は特許権。商標権はブランド、意匠権はデザインを保護する。"),
    q("ip_st_008", "個人情報保護法における安全管理措置の説明として適切なものはどれか。", ["個人情報は無期限で保存する", "目的外利用を自由に認める", "漏えい防止のため技術的・組織的対策を講じる", "外部委託先の管理は不要である"], 2, "漏えい等を防ぐために組織的・人的・物理的・技術的な対策が必要。"),
    q("ip_st_009", "コンプライアンスに関する説明として適切なものはどれか。", ["利益を最優先し法令は後回しにする", "法令や社内規程を遵守して業務を行う", "監査対象部門だけが守ればよい", "外部委託先には適用されない"], 1, "コンプライアンスは法令や規範を守る企業活動全般を指す。"),
    q("ip_st_010", "グリーンITの取組として適切なものはどれか。", ["常時最大性能で稼働させる", "不要なサーバを停止し消費電力を削減する", "紙の帳票を増やす", "利用率の低い機器を追加導入する"], 1, "省電力化や統合による効率運用がグリーンITの基本。"),
    q("ip_st_011", "EコマースにおけるBtoCの説明として適切なものはどれか。", ["企業と企業の取引", "企業と消費者の取引", "消費者と消費者の取引", "行政と企業の取引"], 1, "BtoCはBusiness to Consumerで企業から一般消費者への取引。"),
    q("ip_st_012", "需要予測に基づいて在庫を適正化する主な狙いはどれか。", ["情報セキュリティの強化", "欠品と過剰在庫の抑制", "特許権の取得", "組織図の簡素化"], 1, "需要に応じた在庫管理で欠品と在庫過多の両方を抑える。"),
    q("ip_st_013", "アンゾフの成長マトリクスで、新市場に既存製品を投入する戦略はどれか。", ["市場浸透", "新製品開発", "市場開拓", "多角化"], 2, "市場開拓は既存製品×新市場の組合せ。"),
    q("ip_st_014", "財務三表のうち、一定時点の資産・負債・純資産を示すものはどれか。", ["損益計算書", "貸借対照表", "キャッシュフロー計算書", "製造原価報告書"], 1, "貸借対照表（B/S）は期末時点の財政状態を示す。"),
    q("ip_st_015", "マーケティングの4Pに含まれないものはどれか。", ["Product", "Price", "Place", "People"], 3, "4PはProduct, Price, Place, Promotion。"),
    q("ip_st_016", "BCPにおいてRTOが示すものはどれか。", ["許容可能なデータ損失量", "目標復旧時間", "業務の優先順位", "訓練の実施回数"], 1, "RTOは目標復旧時間で、どれだけ早く復旧するかの目標。"),
    q("ip_st_017", "オープンイノベーションの説明として適切なものはどれか。", ["社外との連携を避ける", "社内技術だけで新製品を開発する", "社外の知見を取り込み価値創出する", "既存技術の利用を禁止する"], 2, "社外の技術やアイデアを活用するのがオープンイノベーション。"),
    q("ip_st_018", "ワークライフバランス施策を進める効果として適切なものはどれか。", ["情報漏えいの完全防止", "従業員満足度や定着率の向上", "特許取得件数の義務化", "監査手続の免除"], 1, "働き方の改善はエンゲージメントと定着率向上に寄与する。"),
    q("ip_st_019", "著作権法上、保護対象として適切なものはどれか。", ["プログラムのソースコード", "数学の定理そのもの", "一般的な業務手順", "アイデアのみ"], 0, "著作権は思想・感情を創作的に表現したものを保護する。"),
    q("ip_st_020", "情報公開請求制度の趣旨として最も近いものはどれか。", ["企業秘密の保護強化", "行政の透明性向上", "個人情報の自由流通", "著作権保護期間の延長"], 1, "情報公開制度は行政文書の開示により透明性を高める制度。"),
]

management_questions = [
    q("ip_mg_001", "WBSを作成する主な目的はどれか。", ["組織図を作るため", "作業を分解し管理しやすくするため", "売上を計上するため", "会計監査を省略するため"], 1, "WBSは作業範囲を分解し、進捗や担当を管理しやすくする。"),
    q("ip_mg_002", "プロジェクト管理におけるクリティカルパスの説明として適切なものはどれか。", ["最もコストが低い作業経路", "遅延すると全体納期に影響する最長経路", "担当者が最も多い経路", "品質検査だけの経路"], 1, "クリティカルパス上の遅れはプロジェクト全体の遅れにつながる。"),
    q("ip_mg_003", "リスクマネジメントで最初に行うべき活動はどれか。", ["リスク対応策の実行", "リスクの特定", "リスクの監査", "リスクの移転契約"], 1, "まずリスクを洗い出し、その後に評価と対応を行う。"),
    q("ip_mg_004", "アジャイル開発の特徴として適切なものはどれか。", ["要件を最初に完全固定する", "短い反復で価値を確認しながら開発する", "変更要求を受け付けない", "工程を一度だけ実施する"], 1, "短いサイクルで実装と評価を繰り返し、変化に対応する。"),
    q("ip_mg_005", "ITILでインシデント管理の目的として適切なものはどれか。", ["根本原因を恒久対策することだけ", "サービスを可能な限り早く復旧すること", "システムを全面刷新すること", "契約書を更新すること"], 1, "インシデント管理は迅速なサービス復旧を重視する。"),
    q("ip_mg_006", "変更管理でCABを設置する主な目的はどれか。", ["開発工数を増やす", "変更の影響と妥当性を審査する", "利用者教育を廃止する", "ログ保存期間を短縮する"], 1, "CABは変更のリスクと影響を多面的に評価する。"),
    q("ip_mg_007", "SLAの説明として適切なものはどれか。", ["ハードウェア購入契約", "サービス提供者と利用者間のサービス品質合意", "ソースコードの著作権譲渡契約", "個人情報の第三者提供同意書"], 1, "SLAは可用性や応答時間などのサービス水準を定める。"),
    q("ip_mg_008", "システム監査で重視される観点として適切なものはどれか。", ["個人の好み", "統制の有効性と遵守状況", "売上目標の達成率のみ", "UIの色使いのみ"], 1, "システム監査は内部統制や規程遵守を客観的に評価する。"),
    q("ip_mg_009", "品質管理でPDCAを回す狙いとして適切なものはどれか。", ["一度の改善で終了する", "継続的に改善を進める", "監査を不要にする", "仕様変更を禁止する"], 1, "PDCAは継続的改善を実現するマネジメント手法。"),
    q("ip_mg_010", "外部委託時のベンダ管理で適切な対応はどれか。", ["契約後は実績確認を行わない", "評価指標を定め定期レビューを行う", "責任分界を曖昧にする", "セキュリティ条項を削除する"], 1, "委託後も品質・納期・セキュリティを継続的に管理する。"),
    q("ip_mg_011", "進捗会議でバーンダウンチャートを使う主な目的はどれか。", ["予算決算書を作成する", "残作業量の推移を可視化する", "法務審査を実施する", "組織改編を決める"], 1, "バーンダウンチャートは残タスクの減少を時系列で示す。"),
    q("ip_mg_012", "受入テストの主な目的はどれか。", ["開発者のスキル評価", "利用者要件を満たすか確認", "ソースコードを圧縮", "ネットワーク機器の在庫確認"], 1, "受入テストは業務要件・運用要件に適合するかを確認する。"),
    q("ip_mg_013", "サービスデスクを一本化する効果として適切なものはどれか。", ["問い合わせ窓口の混乱を減らせる", "障害件数をゼロにできる", "監査を不要にできる", "教育を全廃できる"], 0, "窓口一本化で利用者の利便性と対応品質の向上が期待できる。"),
    q("ip_mg_014", "プロジェクト憲章の役割として適切なものはどれか。", ["運用マニュアルの詳細記述", "プロジェクトの目的・権限・体制の明確化", "毎日の作業日報", "経費精算専用書類"], 1, "プロジェクト憲章は正式な開始と権限付与を示す文書。"),
    q("ip_mg_015", "教育訓練計画を立てる際に最初に行うべきことはどれか。", ["教材を大量購入する", "必要なスキルと現状ギャップを把握する", "参加者をランダム選定する", "研修効果を測定しない"], 1, "現状と目標のギャップ分析が計画の起点になる。"),
    q("ip_mg_016", "問題管理（Problem Management）の目的として適切なものはどれか。", ["障害を都度再起動で回避する", "インシデントの根本原因を分析し再発防止する", "利用者満足度調査を廃止する", "変更管理を不要にする"], 1, "問題管理は根本原因への対処を通じて再発を防ぐ。"),
    q("ip_mg_017", "構成管理でCI（構成アイテム）を管理する主な理由はどれか。", ["保守作業を個人判断に任せるため", "変更影響を把握しやすくするため", "費用見積りを省略するため", "資産台帳を廃止するため"], 1, "構成情報を明確にすることで変更時の影響分析が容易になる。"),
    q("ip_mg_018", "リリース管理で段階的展開を行う利点はどれか。", ["障害発生時の影響範囲を限定できる", "テストを省略できる", "レビューを不要にできる", "契約管理が不要になる"], 0, "一斉展開よりも段階展開の方がリスクを抑えやすい。"),
    q("ip_mg_019", "KPIを設定する際に適切な考え方はどれか。", ["測定できない目標を優先する", "達成状況を定量的に把握できる指標にする", "部門ごとに定義を変えない", "目標との関連を考えない"], 1, "KPIは目標達成度を定量評価できるように設計する。"),
    q("ip_mg_020", "運用引継ぎ時に必要な情報として最も適切なものはどれか。", ["担当者の私用連絡先のみ", "障害対応手順・連絡体制・運用手順書", "導入時の販促資料", "旧版ロゴデータ"], 1, "安定運用には手順・体制・連絡先など実務情報の整備が必要。"),
]

technology_questions = [
    q("ip_te_001", "2進数の1011を10進数に変換した値はどれか。", ["9", "10", "11", "12"], 2, "1011(2)=8+2+1で11。"),
    q("ip_te_002", "32ビットで表現可能なアドレス空間が約4GBとなる理由として適切なものはどれか。", ["2の16乗バイトだから", "2の24乗バイトだから", "2の32乗バイトだから", "2の64乗バイトだから"], 2, "32ビットでは2^32通りのアドレスを扱える。"),
    q("ip_te_003", "主記憶装置（RAM）の特徴として適切なものはどれか。", ["電源断でも内容が保持される", "CPUが直接読み書きに利用する揮発性記憶", "長期保存向けの記憶媒体である", "読み出し専用で書込み不可である"], 1, "RAMは揮発性で高速、CPUの作業領域として使う。"),
    q("ip_te_004", "SSDがHDDに比べて一般に優れる点はどれか。", ["可動部があり衝撃に弱い", "ランダムアクセス性能が高い", "容量単価が常に安い", "磁気ヘッド交換が容易"], 1, "SSDは可動部がなく、ランダムアクセスが高速。"),
    q("ip_te_005", "OSのプロセス管理機能として適切なものはどれか。", ["売上伝票の作成", "CPU時間の割当てと実行制御", "著作権登録の申請", "災害対策訓練の実施"], 1, "プロセス管理は実行中プログラムの資源配分を扱う。"),
    q("ip_te_006", "SQLで表から条件に合う行を取得する命令はどれか。", ["INSERT", "UPDATE", "DELETE", "SELECT"], 3, "SELECTは検索、INSERT/UPDATE/DELETEは更新系命令。"),
    q("ip_te_007", "リレーショナルデータベースで主キーの役割として適切なものはどれか。", ["表の行を一意に識別する", "表の説明文を保持する", "索引を禁止する", "文字コードを変換する"], 0, "主キーは重複なく行を識別するための列。"),
    q("ip_te_008", "LANで同一ネットワーク内の機器を識別するために使うアドレスはどれか。", ["URL", "MACアドレス", "メールアドレス", "ドメイン名"], 1, "MACアドレスはデータリンク層での機器識別に使う。"),
    q("ip_te_009", "TCPの特徴として適切なものはどれか。", ["接続不要で再送制御を行わない", "信頼性を高めるため再送制御を行う", "暗号化を必ず実施する", "IPアドレスを不要にする"], 1, "TCPは順序制御・再送制御で信頼性を確保する。"),
    q("ip_te_010", "DNSの役割として適切なものはどれか。", ["時刻同期を行う", "ドメイン名とIPアドレスを対応付ける", "メール本文を暗号化する", "ファイルを圧縮する"], 1, "DNSは名前解決を担う仕組み。"),
    q("ip_te_011", "HTTPS通信で主に期待される効果はどれか。", ["通信内容の機密性と改ざん検知", "電力消費の削減", "画面解像度の向上", "サーバ容量の増加"], 0, "TLSにより暗号化と完全性確認を行う。"),
    q("ip_te_012", "公開鍵暗号方式の説明として適切なものはどれか。", ["同じ鍵で暗号化と復号を行う", "公開鍵で暗号化し秘密鍵で復号できる", "鍵を使わずに暗号化する", "常に平文より短くなる"], 1, "公開鍵暗号は公開鍵と秘密鍵の対で処理する。"),
    q("ip_te_013", "マルウェアの一種で、自身を他の実行ファイルへ感染させるものはどれか。", ["ワーム", "スパイウェア", "ウイルス", "アドウェア"], 2, "ウイルスは他プログラムに寄生して感染拡大する。"),
    q("ip_te_014", "多層防御（Defense in Depth）の考え方として適切なものはどれか。", ["単一対策に集約する", "複数の対策を重ねて防御する", "物理対策を不要とする", "人的対策を禁止する"], 1, "一つが破られても他の層で被害を抑える設計。"),
    q("ip_te_015", "バックアップの3-2-1ルールの説明として適切なものはどれか。", ["3世代、2媒体、1つはオフサイト保管", "3回暗号化、2回復号、1回削除", "3人で承認、2人で実施、1人で監査", "3時間ごと、2日保存、1か月で削除"], 0, "媒体や保管場所を分散し、復旧可能性を高める。"),
    q("ip_te_016", "クラウドサービスのIaaSに含まれるものとして適切なものはどれか。", ["仮想サーバやストレージ", "業務アプリケーションそのもの", "メール運用代行のみ", "ユーザ教育サービスのみ"], 0, "IaaSはインフラ基盤をサービスとして提供する。"),
    q("ip_te_017", "仮想化技術の効果として適切なものはどれか。", ["1台の物理サーバで複数OSを稼働できる", "全ての障害を自動回避できる", "ネットワーク設定が不要になる", "バックアップが不要になる"], 0, "仮想化により資源集約と柔軟な運用が可能になる。"),
    q("ip_te_018", "生体認証に分類されるものはどれか。", ["パスワード", "ICカード", "指紋認証", "秘密の質問"], 2, "指紋は本人の身体的特徴を利用する認証。"),
    q("ip_te_019", "情報セキュリティにおける可用性を高める施策として適切なものはどれか。", ["冗長化構成を採用する", "パスワードを共有する", "ログを保存しない", "バックアップを停止する"], 0, "冗長化は障害時の継続利用性を高める。"),
    q("ip_te_020", "フィッシング対策として利用者が実施すべき行動はどれか。", ["メール本文のリンクを即時クリックする", "公式サイトをブックマークから開く", "同じパスワードを使い回す", "警告画面を常に無視する"], 1, "リンク経由を避け、公式導線からアクセスするのが安全。"),
]


def write_json(path: Path, genre: str, questions):
    payload = {
        "genre": genre,
        "exam": "ITパスポート試験",
        "questions": questions,
    }
    path.parent.mkdir(parents=True, exist_ok=True)
    path.write_text(json.dumps(payload, ensure_ascii=False, indent=2), encoding="utf-8")


def update_genres_counts():
    p = Path("data/genres.json")
    data = json.loads(p.read_text(encoding="utf-8"))
    subjects = data.get("subjects", [])
    it_exam = next((s for s in subjects if s.get("id") == "it_exam"), None)
    if not it_exam:
        return
    ip = next((e for e in it_exam.get("exams", []) if e.get("id") == "ip"), None)
    if not ip:
        return

    count_map = {
        "ip_strategy": len(strategy_questions),
        "ip_management": len(management_questions),
        "ip_technology": len(technology_questions),
    }
    for sec in ip.get("sections", []):
        sid = sec.get("id")
        if sid in count_map:
            sec["count"] = count_map[sid]
            sec["coming_soon"] = False

    p.write_text(json.dumps(data, ensure_ascii=False, indent=2), encoding="utf-8")


def main():
    write_json(Path("data/ip/questions_ip_strategy.json"), "ストラテジ系", strategy_questions)
    write_json(Path("data/ip/questions_ip_management.json"), "マネジメント系", management_questions)
    write_json(Path("data/ip/questions_ip_technology.json"), "テクノロジ系", technology_questions)
    update_genres_counts()
    print("generated:", len(strategy_questions), len(management_questions), len(technology_questions))


if __name__ == "__main__":
    main()

